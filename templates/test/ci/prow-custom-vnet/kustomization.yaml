apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: default
resources:
- ../../../flavors/default
- ../prow/mhc.yaml
- ../../../addons/cluster-api-helm/calico.yaml
- ../../../addons/cluster-api-helm/azuredisk-csi-driver.yaml
- ../../../addons/cluster-api-helm/cloud-provider-azure.yaml
- ../../../addons/cluster-api-helm/cloud-provider-azure-ci.yaml
patches:
- path: ../patches/tags.yaml
- path: ../patches/mhc.yaml
- path: ../patches/controller-manager.yaml
- path: patches/custom-vnet.yaml
- path: ../patches/uami-md-0.yaml
- path: ../patches/uami-control-plane.yaml
- path: ../patches/cluster-label-calico.yaml
- path: ../patches/cluster-label-cloud-provider-azure.yaml
- target:
    kind: KubeadmConfigTemplate
  patch: |-
    - op: add
      path: /spec/template/spec/preKubeadmCommands/-
      value: echo '10.13.0.100   ${CLUSTER_NAME}-${APISERVER_LB_DNS_SUFFIX}.${AZURE_LOCATION}.cloudapp.azure.com' >> /etc/hosts
- target:
    kind: AzureCluster
  patch: |-
    - op: replace
      path: /spec/networkSpec/apiServerLB/frontendIPs/1/privateIP
      value: 10.13.0.100
- target:
    kind: AzureCluster
  patch: |-
    - op: replace
      path: /spec/networkSpec/vnet/cidrBlocks/0
      value: 10.13.0.0/16
- target:
    kind: AzureCluster
  patch: |-
    - op: add
      path: /spec/networkSpec/subnets/0/cidrBlocks
      value: []
    - op: add
      path: /spec/networkSpec/subnets/0/cidrBlocks/0
      value: 10.13.0.0/24
- target:
    kind: AzureCluster
  patch: |-
    - op: add
      path: /spec/networkSpec/subnets/1/cidrBlocks
      value: []
    - op: add
      path: /spec/networkSpec/subnets/1/cidrBlocks/0
      value: 10.13.1.0/24
- target:
    kind: KubeadmConfigTemplate
  patch: |-
    - op: remove
      path: /spec/template/spec/preKubeadmCommands/0

sortOptions:
  order: fifo
