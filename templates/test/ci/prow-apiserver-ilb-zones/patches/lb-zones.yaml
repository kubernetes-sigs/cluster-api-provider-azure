apiVersion: infrastructure.cluster.x-k8s.io/v1beta1
kind: AzureCluster
metadata:
  name: ${CLUSTER_NAME}
spec:
  networkSpec:
    # Internal API Server Load Balancer with zone-redundant frontend.
    # For internal LBs, zones are set on the frontend IP configuration.
    # See: https://learn.microsoft.com/en-us/azure/reliability/reliability-load-balancer#zone-redundant-load-balancer
    apiServerLB:
      type: Internal
      availabilityZones:
        - "1"
        - "2"
        - "3"
      frontendIPs:
        - name: ${CLUSTER_NAME}-internal-lb-private-ip
          privateIP: ${AZURE_INTERNAL_LB_PRIVATE_IP}
    # Control plane outbound LB for egress traffic (required for private clusters).
    # For public LBs, zones are set on the public IP addresses, NOT on the frontend.
    # See: https://learn.microsoft.com/en-us/azure/reliability/reliability-load-balancer#zone-redundant-load-balancer
    controlPlaneOutboundLB:
      availabilityZones:
        - "1"
        - "2"
        - "3"
      frontendIPs:
        - name: ${CLUSTER_NAME}-cp-outbound-lb
          publicIP:
            name: ${CLUSTER_NAME}-cp-outbound-pip
    # Node outbound LB with zone-redundant public IPs.
    nodeOutboundLB:
      availabilityZones:
        - "1"
        - "2"
        - "3"
      frontendIPs:
        - name: ${CLUSTER_NAME}-node-outbound-lb
          publicIP:
            name: ${CLUSTER_NAME}-node-outbound-pip
