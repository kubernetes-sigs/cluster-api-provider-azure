apiVersion: infrastructure.cluster.x-k8s.io/v1beta1
kind: AzureMachineTemplate
metadata:
  name: ${CLUSTER_NAME}-md-win
spec:
  template:
    spec:
      image:
        # we use the latest image as a workaround there is no published marketplace image for k8s CI versions.
        # the binaries and images will get replaced to the desired version by the pre-kubeadm script.
        computeGallery:
          gallery: ClusterAPI-f72ceb4f-5159-4c26-a0fe-2ea738f0d019
          name: capi-win-${WINDOWS_SERVER_VERSION#windows-}-containerd
          version: latest
      identity: UserAssigned
      userAssignedIdentities:
      - providerID: azure:///subscriptions/${AZURE_SUBSCRIPTION_ID}/resourceGroups/${CI_RG}/providers/Microsoft.ManagedIdentity/userAssignedIdentities/${USER_IDENTITY}
