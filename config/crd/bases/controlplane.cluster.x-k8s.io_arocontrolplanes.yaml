---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: arocontrolplanes.controlplane.cluster.x-k8s.io
spec:
  group: controlplane.cluster.x-k8s.io
  names:
    categories:
    - cluster-api
    kind: AROControlPlane
    listKind: AROControlPlaneList
    plural: arocontrolplanes
    shortNames:
    - arocp
    singular: arocontrolplane
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Cluster to which this AROControl belongs
      jsonPath: .metadata.labels.cluster\.x-k8s\.io/cluster-name
      name: Cluster
      type: string
    - description: Control plane infrastructure is ready for worker nodes
      jsonPath: .status.ready
      name: Ready
      type: string
    - description: OpenShift Console URL
      jsonPath: .status.consoleURL
      name: Console URL
      type: string
    name: v1beta2
    schema:
      openAPIV3Schema:
        description: AROControlPlane is the Schema for the AROControlPlanes API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: AROControlPlaneSpec defines the desired state of AROControlPlane.
            properties:
              additionalTags:
                additionalProperties:
                  type: string
                description: AdditionalTags are user-defined tags to be added on the
                  AWS resources associated with the control plane.
                type: object
              aroClusterName:
                description: |-
                  Cluster name must be a valid DNS-1035 label, so it must consist of lower case alphanumeric
                  characters or '-', start with an alphabetic character, end with an alphanumeric character,
                  and have a maximum length of 54 characters.
                maxLength: 54
                pattern: ^[a-z]([-a-z0-9]*[a-z0-9])?$
                type: string
                x-kubernetes-validations:
                - message: aroClusterName is immutable
                  rule: self == oldSelf
              azureEnvironment:
                description: |-
                  AzureEnvironment is the name of the AzureCloud to be used.
                  The default value that would be used by most users is "AzurePublicCloud", other values are:
                  - ChinaCloud: "AzureChinaCloud"
                  - PublicCloud: "AzurePublicCloud"
                  - USGovernmentCloud: "AzureUSGovernmentCloud"

                  Note that values other than the default must also be accompanied by corresponding changes to the
                  aso-controller-settings Secret to configure ASO to refer to the non-Public cloud. ASO currently does
                  not support referring to multiple different clouds in a single installation. The following fields must
                  be defined in the Secret:
                  - AZURE_AUTHORITY_HOST
                  - AZURE_RESOURCE_MANAGER_ENDPOINT
                  - AZURE_RESOURCE_MANAGER_AUDIENCE

                  See the [ASO docs] for more details.

                  [ASO docs]: https://azure.github.io/azure-service-operator/guide/aso-controller-settings-options/
                type: string
              channelGroup:
                default: stable
                description: OpenShift version channel group; default is stable.
                enum:
                - stable
                - candidate
                - nightly
                - fast
                - eus
                type: string
              domainPrefix:
                description: |-
                  DomainPrefix is an optional prefix added to the cluster's domain name. It will be used
                  when generating a sub-domain for the cluster on the openshiftapps domain. It must be a valid DNS-1035 label
                  consisting of lower case alphanumeric characters or '-', start with an alphabetic character,
                  end with an alphanumeric character, and have a maximum length of 15 characters.
                maxLength: 15
                pattern: ^[a-z]([-a-z0-9]*[a-z0-9])?$
                type: string
                x-kubernetes-validations:
                - message: domainPrefix is immutable
                  rule: self == oldSelf
              enableExternalAuthProviders:
                default: false
                description: EnableExternalAuthProviders enables external authentication
                  configuration for the cluster.
                type: boolean
                x-kubernetes-validations:
                - message: enableExternalAuthProviders is immutable
                  rule: self == oldSelf
              externalAuthProviders:
                description: |-
                  ExternalAuthProviders are external OIDC identity providers that can issue tokens for this cluster.
                  Can only be set if "enableExternalAuthProviders" is set to "True".

                  At most one provider can be configured.
                items:
                  description: ExternalAuthProvider is an external OIDC identity provider
                    that can issue tokens for this cluster.
                  properties:
                    claimMappings:
                      description: |-
                        ClaimMappings describes rules on how to transform information from an
                        ID token into a cluster identity
                      properties:
                        groups:
                          description: |-
                            Groups is a name of the claim that should be used to construct
                            groups for the cluster identity.
                            The referenced claim must use array of strings values.
                          properties:
                            claim:
                              description: Claim is a JWT token claim to be used in
                                the mapping
                              type: string
                            prefix:
                              description: |-
                                Prefix is a string to prefix the value from the token in the result of the
                                claim mapping.

                                By default, no prefixing occurs.

                                Example: if `prefix` is set to "myoidc:"" and the `claim` in JWT contains
                                an array of strings "a", "b" and  "c", the mapping will result in an
                                array of string "myoidc:a", "myoidc:b" and "myoidc:c".
                              type: string
                          required:
                          - claim
                          type: object
                        username:
                          description: |-
                            Username is a name of the claim that should be used to construct
                            usernames for the cluster identity.

                            Default value: "sub"
                          properties:
                            claim:
                              description: Claim is a JWT token claim to be used in
                                the mapping
                              type: string
                            prefix:
                              description: Prefix is prepended to claim to prevent
                                clashes with existing names.
                              minLength: 1
                              type: string
                            prefixPolicy:
                              description: |-
                                PrefixPolicy specifies how a prefix should apply.

                                By default, claims other than `email` will be prefixed with the issuer URL to
                                prevent naming clashes with other plugins.

                                Set to "NoPrefix" to disable prefixing.

                                Example:
                                    (1) `prefix` is set to "myoidc:" and `claim` is set to "username".
                                        If the JWT claim `username` contains value `userA`, the resulting
                                        mapped value will be "myoidc:userA".
                                    (2) `prefix` is set to "myoidc:" and `claim` is set to "email". If the
                                        JWT `email` claim contains value "userA@myoidc.tld", the resulting
                                        mapped value will be "myoidc:userA@myoidc.tld".
                                    (3) `prefix` is unset, `issuerURL` is set to `https://myoidc.tld`,
                                        the JWT claims include "username":"userA" and "email":"userA@myoidc.tld",
                                        and `claim` is set to:
                                        (a) "username": the mapped value will be "https://myoidc.tld#userA"
                                        (b) "email": the mapped value will be "userA@myoidc.tld"
                              enum:
                              - ""
                              - NoPrefix
                              - Prefix
                              type: string
                          required:
                          - claim
                          type: object
                          x-kubernetes-validations:
                          - message: prefix must be set if prefixPolicy is 'Prefix',
                              but must remain unset otherwise
                            rule: 'self.prefixPolicy == ''Prefix'' ? has(self.prefix)
                              : !has(self.prefix)'
                      type: object
                    claimValidationRules:
                      description: ClaimValidationRules are rules that are applied
                        to validate token claims to authenticate users.
                      items:
                        description: TokenClaimValidationRule validates token claims
                          to authenticate users.
                        properties:
                          requiredClaim:
                            description: RequiredClaim allows configuring a required
                              claim name and its expected value
                            properties:
                              claim:
                                description: |-
                                  Claim is a name of a required claim. Only claims with string values are
                                  supported.
                                minLength: 1
                                type: string
                              requiredValue:
                                description: RequiredValue is the required value for
                                  the claim.
                                minLength: 1
                                type: string
                            required:
                            - claim
                            - requiredValue
                            type: object
                          type:
                            default: RequiredClaim
                            description: Type sets the type of the validation rule
                            enum:
                            - RequiredClaim
                            type: string
                        required:
                        - requiredClaim
                        - type
                        type: object
                      type: array
                      x-kubernetes-list-type: atomic
                    issuer:
                      description: Issuer describes attributes of the OIDC token issuer
                      properties:
                        audiences:
                          description: |-
                            Audiences is an array of audiences that the token was issued for.
                            Valid tokens must include at least one of these values in their
                            "aud" claim.
                            Must be set to exactly one value.
                          items:
                            description: TokenAudience is the audience that the token
                              was issued for.
                            minLength: 1
                            type: string
                          maxItems: 10
                          minItems: 1
                          type: array
                          x-kubernetes-list-type: set
                        issuerCertificateAuthority:
                          description: |-
                            CertificateAuthority is a reference to a config map in the
                            configuration namespace. The .data of the configMap must contain
                            the "ca-bundle.crt" key.
                            If unset, system trust is used instead.
                          properties:
                            name:
                              description: Name is the metadata.name of the referenced
                                object.
                              type: string
                          required:
                          - name
                          type: object
                        issuerURL:
                          description: |-
                            URL is the serving URL of the token issuer.
                            Must use the https:// scheme.
                          pattern: ^https:\/\/[^\s]
                          type: string
                      required:
                      - audiences
                      - issuerURL
                      type: object
                    name:
                      description: Name of the OIDC provider
                      minLength: 1
                      type: string
                    oidcClients:
                      description: |-
                        OIDCClients contains configuration for the platform's clients that
                        need to request tokens from the issuer
                      items:
                        description: |-
                          OIDCClientConfig contains configuration for the platform's client that
                          need to request tokens from the issuer.
                        properties:
                          clientID:
                            description: ClientID is the identifier of the OIDC client
                              from the OIDC provider
                            minLength: 1
                            type: string
                          clientSecret:
                            description: |-
                              ClientSecret refers to a secret that
                              contains the client secret in the `clientSecret` key of the `.data` field
                            properties:
                              name:
                                description: Name is the metadata.name of the referenced
                                  object.
                                type: string
                            required:
                            - name
                            type: object
                          componentName:
                            description: |-
                              ComponentName is the name of the component that is supposed to consume this
                              client configuration
                            maxLength: 256
                            minLength: 1
                            type: string
                          componentNamespace:
                            description: |-
                              ComponentNamespace is the namespace of the component that is supposed to consume this
                              client configuration
                            maxLength: 63
                            minLength: 1
                            type: string
                          extraScopes:
                            description: ExtraScopes is an optional set of scopes
                              to request tokens with.
                            items:
                              type: string
                            type: array
                            x-kubernetes-list-type: set
                        required:
                        - clientID
                        - clientSecret
                        - componentName
                        - componentNamespace
                        type: object
                      maxItems: 20
                      type: array
                      x-kubernetes-list-map-keys:
                      - componentNamespace
                      - componentName
                      x-kubernetes-list-type: map
                  required:
                  - issuer
                  - name
                  type: object
                maxItems: 1
                type: array
                x-kubernetes-list-map-keys:
                - name
                x-kubernetes-list-type: map
              identityRef:
                description: |-
                  IdentityRef is a reference to an identity to be used when reconciling the aro control plane.
                  If no identity is specified, the default identity for this controller will be used.
                properties:
                  apiVersion:
                    description: API version of the referent.
                    type: string
                  fieldPath:
                    description: |-
                      If referring to a piece of an object instead of an entire object, this string
                      should contain a valid JSON/Go field access statement, such as desiredState.manifest.containers[2].
                      For example, if the object reference is to a container within a pod, this would take on a value like:
                      "spec.containers{name}" (where "name" refers to the name of the container that triggered
                      the event) or if no container name is specified "spec.containers[2]" (container with
                      index 2 in this pod). This syntax is chosen only to have some well-defined way of
                      referencing a part of an object.
                    type: string
                  kind:
                    description: |-
                      Kind of the referent.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
                    type: string
                  name:
                    description: |-
                      Name of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                    type: string
                  namespace:
                    description: |-
                      Namespace of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/
                    type: string
                  resourceVersion:
                    description: |-
                      Specific resourceVersion to which this reference is made, if any.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency
                    type: string
                  uid:
                    description: |-
                      UID of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids
                    type: string
                type: object
                x-kubernetes-map-type: atomic
              network:
                description: Network config for the ARO HCP cluster.
                properties:
                  hostPrefix:
                    default: 23
                    description: Network host prefix which is defaulted to `23` if
                      not specified.
                    type: integer
                  machineCIDR:
                    description: IP addresses block used by OpenShift while installing
                      the cluster, for example "10.0.0.0/16".
                    format: cidr
                    type: string
                  networkType:
                    default: OVNKubernetes
                    description: The CNI network type; default is OVNKubernetes.
                    enum:
                    - OVNKubernetes
                    - Other
                    type: string
                  podCIDR:
                    description: IP address block from which to assign pod IP addresses,
                      for example `10.128.0.0/14`.
                    format: cidr
                    type: string
                  serviceCIDR:
                    description: IP address block from which to assign service IP
                      addresses, for example `172.30.0.0/16`.
                    format: cidr
                    type: string
                type: object
              platform:
                description: AROPlatformProfileControlPlane represents the Azure platform
                  configuration.
                properties:
                  keyVault:
                    description: Azure KeyVault id
                    type: string
                  location:
                    description: Location should be valid Azure location ex; centralus
                    type: string
                  managedIdentities:
                    description: ManagedIdentities Azure managed identities for ARO
                      HCP.
                    properties:
                      controlPlaneOperators:
                        description: ControlPlaneOperators Ref to Microsoft.ManagedIdentity/userAssignedIdentities
                        properties:
                          cloudControllerManager:
                            description: CloudControllerManagerManagedIdentities "cloud-controller-manager"
                              Microsoft.ManagedIdentity/userAssignedIdentities
                            type: string
                          cloudNetworkConfigManagedIdentities:
                            description: CloudNetworkConfigManagedIdentities "cloud-network-config"
                              Microsoft.ManagedIdentity/userAssignedIdentities
                            type: string
                          clusterApiAzureManagedIdentities:
                            description: ClusterAPIAzureManagedIdentities "cluster-api-azure"
                              Microsoft.ManagedIdentity/userAssignedIdentities
                            type: string
                          controlPlaneOperatorsManagedIdentities:
                            description: ControlPlaneManagedIdentities "control-plane"
                              Microsoft.ManagedIdentity/userAssignedIdentities
                            type: string
                          diskCsiDriverManagedIdentities:
                            description: DiskCsiDriverManagedIdentities "disk-csi-driver"
                              Microsoft.ManagedIdentity/userAssignedIdentities
                            type: string
                          fileCsiDriverManagedIdentities:
                            description: FileCsiDriverManagedIdentities "file-csi-driver"
                              Microsoft.ManagedIdentity/userAssignedIdentities
                            type: string
                          imageRegistryManagedIdentities:
                            description: ImageRegistryManagedIdentities "image-registry"
                              Microsoft.ManagedIdentity/userAssignedIdentities
                            type: string
                          ingressManagedIdentities:
                            description: IngressManagedIdentities "ingress" Microsoft.ManagedIdentity/userAssignedIdentities
                            type: string
                          kmsManagedIdentities:
                            description: KmsManagedIdentities "kms" Microsoft.ManagedIdentity/userAssignedIdentities
                            type: string
                        type: object
                      createAROHCPManagedIdentities:
                        description: |-
                          CreateAROHCPManagedIdentities is used to create the required ARO-HCP managed identities if not provided.
                          It will create UserAssignedIdentity CR for each required managed identity. Default is false.
                        type: boolean
                      dataPlaneOperators:
                        description: DataPlaneOperators ref to Microsoft.ManagedIdentity/userAssignedIdentities
                        properties:
                          diskCsiDriverManagedIdentities:
                            description: DiskCsiDriverManagedIdentities "disk-csi-driver"
                              Microsoft.ManagedIdentity/userAssignedIdentities
                            type: string
                          fileCsiDriverManagedIdentities:
                            description: FileCsiDriverManagedIdentities "file-csi-driver"
                              Microsoft.ManagedIdentity/userAssignedIdentities
                            type: string
                          imageRegistryManagedIdentities:
                            description: ImageRegistryManagedIdentities "image-registry"
                              Microsoft.ManagedIdentity/userAssignedIdentities
                            type: string
                        type: object
                      serviceManagedIdentity:
                        description: ServiceManagedIdentity ref to Microsoft.ManagedIdentity/userAssignedIdentities
                        type: string
                    type: object
                  networkSecurityGroupId:
                    description: Azure Network Security Group ID
                    type: string
                  outboundType:
                    description: OutboundType represents a routing strategy to provide
                      egress to the Internet. Allowed value is loadBalancer
                    type: string
                  resourceGroup:
                    description: Resource group name where the ARO-hcp will be attached
                      to it.
                    type: string
                  resourceGroupRef:
                    description: ResourceGroupRef is the name that is used to create
                      the ResourceGroup CR. The ResourceGroupRef must be in the same
                      namespace as the AROControlPlane and cannot be set with ResourceGroup.
                    type: string
                  subnet:
                    description: Azure subnet id
                    type: string
                  subnetRef:
                    description: SubnetRef is the name that is used to create the
                      VirtualNetworksSubnet CR. The SubnetRef must be in the same
                      namespace as the AROControlPlane and cannot be set with Subnet.
                    type: string
                type: object
              subscriptionID:
                description: SubscriptionID is the GUID of the Azure subscription
                  that owns this cluster.
                type: string
              version:
                description: OpenShift semantic version, for example "4.14.5".
                type: string
              versionGate:
                default: WaitForAcknowledge
                description: |-
                  VersionGate requires acknowledgment when upgrading ARO-HCP y-stream versions (e.g., from 4.15 to 4.16).
                  Default is WaitForAcknowledge.
                  WaitForAcknowledge: If acknowledgment is required, the upgrade will not proceed until VersionGate is set to Acknowledge or AlwaysAcknowledge.
                  Acknowledge: If acknowledgment is required, apply it for the upgrade. After upgrade is done set the version gate to WaitForAcknowledge.
                  AlwaysAcknowledge: If acknowledgment is required, apply it and proceed with the upgrade.
                enum:
                - Acknowledge
                - WaitForAcknowledge
                - AlwaysAcknowledge
                type: string
              visibility:
                description: Visibility represents the visibility of an API endpoint.
                  Allowed values are public and private; default is public.
                type: string
            required:
            - aroClusterName
            - channelGroup
            - version
            - versionGate
            type: object
          status:
            description: AROControlPlaneStatus defines the observed state of AROControlPlane.
            properties:
              apiURL:
                description: APIURL is the url for the ARO-HCP openshift cluster api
                  endPoint.
                type: string
              availableUpgrades:
                description: Available upgrades for the ARO hosted control plane.
                items:
                  type: string
                type: array
              conditions:
                description: Conditions specifies the conditions for the managed control
                  plane
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              consoleURL:
                description: ConsoleURL is the url for the openshift console.
                type: string
              failureMessage:
                description: |-
                  FailureMessage will be set in the event that there is a terminal problem
                  reconciling the state and will be set to a descriptive error message.

                  This field should not be set for transitive errors that a controller
                  faces that are expected to be fixed automatically over
                  time (like service outages), but instead indicate that something is
                  fundamentally wrong with the spec or the configuration of
                  the controller, and that manual intervention is required.
                type: string
              id:
                description: ID is the cluster ID given by ARO.
                type: string
              initialization:
                description: |-
                  initialization provides observations of the AROControlPlane initialization process.
                  NOTE: Fields in this struct are part of the Cluster API contract and are used to orchestrate initial Machine provisioning.
                properties:
                  controlPlaneInitialized:
                    description: |-
                      controlPlaneInitialized is true when the AROControlPlane provider reports that the Kubernetes control plane is initialized;
                      A control plane is considered initialized when it can accept requests, no matter if this happens before
                      the control plane is fully provisioned or not.
                      NOTE: this field is part of the Cluster API contract, and it is used to orchestrate initial Machine provisioning.
                    type: boolean
                type: object
              longRunningOperationStates:
                description: |-
                  LongRunningOperationStates saves the state for ARO long-running operations so they can be continued on the
                  next reconciliation loop.
                items:
                  description: Future contains the data needed for an Azure long-running
                    operation to continue across reconcile loops.
                  properties:
                    data:
                      description: Data is the base64 url encoded json Azure AutoRest
                        Future.
                      type: string
                    name:
                      description: |-
                        Name is the name of the Azure resource.
                        Together with the service name, this forms the unique identifier for the future.
                      type: string
                    resourceGroup:
                      description: ResourceGroup is the Azure resource group for the
                        resource.
                      type: string
                    serviceName:
                      description: |-
                        ServiceName is the name of the Azure service.
                        Together with the name of the resource, this forms the unique identifier for the future.
                      type: string
                    type:
                      description: Type describes the type of future, such as update,
                        create, delete, etc.
                      type: string
                  required:
                  - data
                  - name
                  - serviceName
                  - type
                  type: object
                type: array
              ready:
                default: false
                description: Ready denotes that the AROControlPlane API Server is
                  ready to receive requests.
                type: boolean
              version:
                description: ARO-HCP OpenShift semantic version, for example "4.20.0".
                type: string
            required:
            - ready
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
